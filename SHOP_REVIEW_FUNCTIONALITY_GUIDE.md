# 店铺入驻审核功能使用指南

## 📋 功能概述

本系统实现了完整的店铺入驻审核流程，包括待审核店铺管理和已审核店铺管理两大核心功能模块。

## 🎯 核心功能

### 1. 待审核店铺管理 (/admin/shops/pending)

#### 功能特点：
- **列表展示**：展示所有状态为 `pending` 的店铺申请
- **搜索筛选**：支持按店铺名称、联系人、城市等关键词搜索
- **批量操作**：支持批量通过或驳回店铺申请
- **详情查看**：可展开查看店铺详细信息和资质图片
- **单个操作**：支持对单个店铺进行审核操作

#### 操作流程：
1. 进入「店铺管理」→「待审核店铺」
2. 查看待审核店铺列表
3. 点击「详情」查看店铺资质信息（营业执照、门头照等）
4. 选择需要审核的店铺（可多选）
5. 点击「批量通过」或「批量驳回」
6. 驳回时需填写驳回原因

### 2. 已审核店铺管理 (/admin/shops)

#### 功能特点：
- **状态管理**：管理已通过、已驳回、已禁用的店铺
- **信息编辑**：可编辑店铺基本信息
- **状态切换**：支持启用/禁用店铺
- **数据统计**：显示店铺评分、评论数等信息
- **批量操作**：支持批量管理操作

#### 操作流程：
1. 进入「店铺管理」→「已审核店铺」
2. 使用搜索和筛选功能查找店铺
3. 点击「详情」查看完整信息
4. 使用「编辑」按钮修改店铺信息
5. 通过「启用」/「禁用」按钮管理店铺状态
6. 必要时可删除店铺

## 🔧 技术实现

### 数据库结构增强

新增 `sub_roles` 字段到 `user_profiles_ext` 表：
```sql
ALTER TABLE user_profiles_ext 
ADD COLUMN IF NOT EXISTS sub_roles text[];
```

### API 接口

#### 待审核店铺接口
- `GET /api/admin/shops/pending` - 获取待审核店铺列表
- `POST /api/admin/shops/pending` - 批量审核操作

#### 已审核店铺接口
- `GET /api/admin/shops` - 获取已审核店铺列表
- `POST /api/admin/shops` - 创建新店铺
- `GET /api/admin/shops/[id]` - 获取店铺详情
- `PUT /api/admin/shops/[id]` - 更新店铺信息
- `DELETE /api/admin/shops/[id]` - 删除店铺

### 权限控制

使用现有的 RBAC 系统：
- **shop_reviewer** 角色：可访问所有店铺管理功能
- **admin** 角色：拥有全部权限

## 🎨 界面设计

### 待审核店铺页面特色：
- 复选框支持批量选择
- 展开式详情查看
- 资质图片预览
- 状态标签清晰标识

### 已审核店铺页面特色：
- 评分星级显示
- 状态切换按钮
- 详细信息面板
- 编辑对话框

## ⚙️ 审核流程

### 通过审核流程：
1. 管理员在待审核页面选择店铺
2. 点击「通过审核」或「批量通过」
3. 系统自动将店铺状态改为 `approved`
4. 自动为店主用户添加 `shop_owner` 子角色
5. 店铺出现在已审核店铺列表中

### 驳回流程：
1. 管理员选择需要驳回的店铺
2. 点击「驳回申请」并填写驳回原因
3. 系统将店铺状态改为 `rejected`
4. 记录驳回时间和原因

## 📊 状态说明

| 状态 | 说明 | 可见性 |
|------|------|--------|
| pending | 待审核 | 仅在待审核页面可见 |
| approved | 已通过 | 在已审核页面可见，默认启用 |
| rejected | 已驳回 | 在已审核页面可见，可重新启用 |
| disabled | 已禁用 | 在已审核页面可见，可重新启用 |

## 🔒 安全机制

1. **权限验证**：所有操作都需要相应角色权限
2. **数据隔离**：不同角色只能看到授权范围内的数据
3. **操作日志**：关键操作都有时间戳记录
4. **输入验证**：前后端双重数据验证

## 📱 使用建议

### 最佳实践：
- 定期检查待审核店铺，保持处理时效性
- 驳回时务必填写详细原因，便于申请人改进
- 启用/禁用店铺前确认业务影响
- 定期备份重要店铺数据

### 注意事项：
- 批量操作前仔细确认选择的店铺
- 删除店铺为不可逆操作，请谨慎使用
- 修改店铺信息会影响前端展示效果
- 角色变更需要重新登录才能生效

## 🆘 常见问题

**Q: 为什么看不到某些店铺？**
A: 检查当前用户的权限角色和店铺的状态过滤条件

**Q: 驳回后还能重新审核吗？**
A: 可以，在已审核店铺页面将状态改为启用即可重新上线

**Q: 如何联系店铺负责人？**
A: 店铺详情中包含联系电话和联系人信息

**Q: 支持哪些图片格式？**
A: 系统支持常见的图片格式（JPG、PNG、GIF等）

---

## 📞 技术支持

如有任何问题或建议，请联系系统管理员。