# ç”¨æˆ·ç®¡ç†æ¨¡å—å®æ–½æŠ¥å‘Š

## ğŸ¯ ä»»åŠ¡æ¦‚è¿°
**ä»»åŠ¡A10ï¼šç”¨æˆ·ç®¡ç†æ¨¡å—**
- ç›®æ ‡ï¼šå®ç°ç®¡ç†å‘˜æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ã€ä¿®æ”¹ç”¨æˆ·è§’è‰²ã€å°ç¦ç”¨æˆ·åŠŸèƒ½
- é¡µé¢ï¼š`/admin/users`
- æ ¸å¿ƒåŠŸèƒ½ï¼šç”¨æˆ·åˆ—è¡¨å±•ç¤ºã€è§’è‰²åˆ†é…ã€å°ç¦ç®¡ç†ã€æ‰¹é‡æ“ä½œ

## ğŸ“‹ åŠŸèƒ½å®ç°æ¸…å•

### âœ… å·²å®ŒæˆåŠŸèƒ½

#### 1. æ•°æ®åº“å±‚
- [x] åˆ›å»ºç”¨æˆ·çŠ¶æ€æšä¸¾ç±»å‹ (`user_status`)
- [x] ä¸º `user_profiles_ext` è¡¨æ·»åŠ çŠ¶æ€å­—æ®µ
- [x] æ·»åŠ å°ç¦ç›¸å…³ä¿¡æ¯å­—æ®µ (`banned_reason`, `banned_at`, `unbanned_at`)
- [x] åˆ›å»ºç”¨æˆ·ç®¡ç†è§†å›¾ (`user_management_view`)
- [x] æ›´æ–°RLSç­–ç•¥æ”¯æŒçŠ¶æ€æ£€æŸ¥

#### 2. APIæ¥å£å±‚
- [x] å®ç°ç”¨æˆ·åˆ—è¡¨è·å–æ¥å£ (`GET /api/admin/users`)
- [x] å®ç°ç”¨æˆ·ä¿¡æ¯æ›´æ–°æ¥å£ (`PUT /api/admin/users`)
- [x] å®ç°æ‰¹é‡ç”¨æˆ·æ“ä½œæ¥å£ (`POST /api/admin/users`)
- [x] æ”¯æŒæœç´¢ã€ç­›é€‰ã€åˆ†é¡µåŠŸèƒ½
- [x] æƒé™éªŒè¯å’Œå®‰å…¨æ§åˆ¶

#### 3. å‰ç«¯ç•Œé¢å±‚
- [x] ç”¨æˆ·åˆ—è¡¨é¡µé¢ (`/admin/users`)
- [x] æœç´¢åŠŸèƒ½ï¼ˆæŒ‰é‚®ç®±ã€ç”¨æˆ·IDï¼‰
- [x] è§’è‰²ç­›é€‰åŠŸèƒ½
- [x] çŠ¶æ€ç­›é€‰åŠŸèƒ½
- [x] ç”¨æˆ·ç¼–è¾‘æ¨¡æ€æ¡†
- [x] æ‰¹é‡æ“ä½œå·¥å…·æ 
- [x] å“åº”å¼è®¾è®¡

#### 4. æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½
- [x] ç”¨æˆ·è§’è‰²åˆ†é…ï¼ˆä¸‹æ‹‰é€‰æ‹©ï¼‰
- [x] å­è§’è‰²ç®¡ç†ï¼ˆå¤šè§’è‰²æ”¯æŒï¼‰
- [x] ç”¨æˆ·å°ç¦/è§£å°åŠŸèƒ½
- [x] æ‰¹é‡å°ç¦æ“ä½œ
- [x] ç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼ˆactive/banned/suspendedï¼‰

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•°æ®åº“ç»“æ„å˜æ›´

```sql
-- æ–°å¢ç”¨æˆ·çŠ¶æ€æšä¸¾
create type user_status as enum ('active', 'banned', 'suspended');

-- æ‰©å±•ç”¨æˆ·æ¡£æ¡ˆè¡¨
alter table user_profiles_ext 
add column if not exists status user_status default 'active',
add column if not exists banned_reason text,
add column if not exists banned_at timestamp with time zone,
add column if not exists unbanned_at timestamp with time zone;

-- åˆ›å»ºç®¡ç†è§†å›¾
create or replace view user_management_view as
select 
  upe.id,
  upe.user_id,
  upe.email,
  upe.role,
  upe.sub_roles,
  upe.status,
  upe.is_active,
  upe.banned_reason,
  upe.banned_at,
  upe.unbanned_at,
  upe.created_at,
  upe.updated_at,
  au.role as admin_role,
  au.is_active as admin_is_active
from user_profiles_ext upe
left join admin_users au on upe.user_id = au.user_id;
```

### APIæ¥å£è®¾è®¡

#### è·å–ç”¨æˆ·åˆ—è¡¨
```http
GET /api/admin/users?search=å…³é”®è¯&role=è§’è‰²&status=çŠ¶æ€&page=1&limit=20
```

#### æ›´æ–°ç”¨æˆ·ä¿¡æ¯
```http
PUT /api/admin/users
Content-Type: application/json

{
  "userId": "ç”¨æˆ·ID",
  "updates": {
    "role": "æ–°è§’è‰²",
    "sub_roles": ["å­è§’è‰²1", "å­è§’è‰²2"],
    "status": "ç”¨æˆ·çŠ¶æ€",
    "banned_reason": "å°ç¦åŸå› " // å½“statusä¸ºbannedæ—¶å¿…å¡«
  }
}
```

#### æ‰¹é‡æ“ä½œç”¨æˆ·
```http
POST /api/admin/users
Content-Type: application/json

{
  "action": "ban|unban|activate|deactivate",
  "userIds": ["ç”¨æˆ·ID1", "ç”¨æˆ·ID2"],
  "reason": "æ“ä½œåŸå› " // å°ç¦æ—¶å¿…å¡«
}
```

### å‰ç«¯ç»„ä»¶ç»“æ„

```
src/app/admin/users/page.tsx
â”œâ”€â”€ UsersPage (ä¸»é¡µé¢ç»„ä»¶)
â”‚   â”œâ”€â”€ çŠ¶æ€ç®¡ç† (useState hooks)
â”‚   â”œâ”€â”€ ç”¨æˆ·æ•°æ®åŠ è½½ (loadUsers)
â”‚   â”œâ”€â”€ æœç´¢ç­›é€‰åŠŸèƒ½
â”‚   â”œâ”€â”€ æ‰¹é‡æ“ä½œåŠŸèƒ½
â”‚   â””â”€â”€ ç”¨æˆ·ç¼–è¾‘åŠŸèƒ½
â”œâ”€â”€ EditUserModal (ç¼–è¾‘æ¨¡æ€æ¡†)
â”‚   â”œâ”€â”€ è§’è‰²é€‰æ‹©
â”‚   â”œâ”€â”€ å­è§’è‰²è¾“å…¥
â”‚   â”œâ”€â”€ çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ å°ç¦åŸå› è¾“å…¥
â””â”€â”€ è¾…åŠ©å‡½æ•°
    â”œâ”€â”€ getStatusDisplay (çŠ¶æ€æ˜¾ç¤º)
    â”œâ”€â”€ getRoleDisplay (è§’è‰²æ˜¾ç¤º)
    â””â”€â”€ æ‰¹é‡æ“ä½œå¤„ç†
```

## ğŸ”§ ä½¿ç”¨è¯´æ˜

### è®¿é—®è·¯å¾„
- **ç”¨æˆ·ç®¡ç†é¡µé¢**: `/admin/users`
- **æƒé™è¦æ±‚**: å¿…é¡»å…·æœ‰ `admin` è§’è‰²

### ä¸»è¦åŠŸèƒ½æ“ä½œ

#### 1. æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
- é»˜è®¤æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·
- æ”¯æŒæŒ‰é‚®ç®±ã€ç”¨æˆ·IDæœç´¢
- å¯æŒ‰è§’è‰²ã€çŠ¶æ€ç­›é€‰
- æ˜¾ç¤ºç”¨æˆ·åŸºæœ¬ä¿¡æ¯ã€è§’è‰²ã€çŠ¶æ€ç­‰

#### 2. ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯
- ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®æ‰“å¼€ç¼–è¾‘æ¨¡æ€æ¡†
- å¯ä¿®æ”¹ç”¨æˆ·è§’è‰²ï¼ˆä¸‹æ‹‰é€‰æ‹©ï¼‰
- å¯è®¾ç½®å­è§’è‰²ï¼ˆé€—å·åˆ†éš”ï¼‰
- å¯æ›´æ”¹ç”¨æˆ·çŠ¶æ€ï¼ˆæ­£å¸¸/å°ç¦/æš‚åœï¼‰
- å°ç¦æ—¶éœ€å¡«å†™å°ç¦åŸå› 

#### 3. ç”¨æˆ·å°ç¦æ“ä½œ
- å•ä¸ªç”¨æˆ·ï¼šç‚¹å‡»"å°ç¦"æŒ‰é’®
- æ‰¹é‡å°ç¦ï¼šé€‰æ‹©å¤šä¸ªç”¨æˆ·åä½¿ç”¨æ‰¹é‡æ“ä½œ
- éœ€è¦å¡«å†™å°ç¦åŸå› 
- ç³»ç»Ÿè‡ªåŠ¨è®°å½•å°ç¦æ—¶é—´å’Œæ“ä½œäºº

#### 4. æ‰¹é‡æ“ä½œ
- æ”¯æŒå¤šé€‰ç”¨æˆ·ï¼ˆå‹¾é€‰å¤é€‰æ¡†ï¼‰
- æ‰¹é‡å°ç¦ï¼šç»Ÿä¸€è®¾ç½®å°ç¦åŸå› 
- æ‰¹é‡è§£å°ï¼šæ¢å¤ç”¨æˆ·æ­£å¸¸ä½¿ç”¨
- æ‰¹é‡æ¿€æ´»/åœç”¨ï¼šæ§åˆ¶ç³»ç»Ÿè®¿é—®æƒé™

### è§’è‰²åˆ†é…é€»è¾‘

#### å¯åˆ†é…è§’è‰²
- `admin`: è¶…çº§ç®¡ç†å‘˜ï¼ˆæœ€é«˜æƒé™ï¼‰
- `content_reviewer`: å†…å®¹å®¡æ ¸å‘˜
- `shop_reviewer`: åº—é“ºå®¡æ ¸å‘˜
- `finance`: è´¢åŠ¡äººå‘˜
- `viewer`: æŸ¥çœ‹è€…ï¼ˆåªè¯»æƒé™ï¼‰

#### å­è§’è‰²ç³»ç»Ÿ
- æ”¯æŒä¸ºç”¨æˆ·åˆ†é…å¤šä¸ªå­è§’è‰²
- å¸¸è§å­è§’è‰²ï¼š`shop_owner`ï¼ˆåº—é“ºæ‰€æœ‰è€…ï¼‰ã€`content_creator`ï¼ˆå†…å®¹åˆ›ä½œè€…ï¼‰
- ç”¨äºç»†ç²’åº¦æƒé™æ§åˆ¶

#### çŠ¶æ€ç®¡ç†
- `active`: æ­£å¸¸çŠ¶æ€ï¼Œå¯æ­£å¸¸ä½¿ç”¨ç³»ç»Ÿ
- `banned`: å·²å°ç¦ï¼Œæ— æ³•ç™»å½•å’Œä½¿ç”¨ç³»ç»Ÿ
- `suspended`: å·²æš‚åœï¼Œé™åˆ¶éƒ¨åˆ†åŠŸèƒ½ä½¿ç”¨

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### æƒé™æ§åˆ¶
- ä»…è¶…çº§ç®¡ç†å‘˜å¯è®¿é—®ç”¨æˆ·ç®¡ç†é¡µé¢
- æ‰€æœ‰APIæ¥å£éƒ½æœ‰æƒé™éªŒè¯
- RLSç­–ç•¥ç¡®ä¿æ•°æ®å®‰å…¨è®¿é—®

### æ“ä½œå®¡è®¡
- è®°å½•æ‰€æœ‰ç”¨æˆ·çŠ¶æ€å˜æ›´
- ä¿å­˜å°ç¦/è§£å°æ“ä½œæ—¥å¿—
- è¿½è¸ªæ“ä½œäººå’Œæ“ä½œæ—¶é—´

### æ•°æ®ä¿æŠ¤
- æ•æ„Ÿä¿¡æ¯è„±æ•æ˜¾ç¤º
- æ“ä½œå‰äºŒæ¬¡ç¡®è®¤
- å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶

## ğŸ“Š æµ‹è¯•éªŒè¯

### è‡ªåŠ¨åŒ–æµ‹è¯•
è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½å®Œæ•´æ€§ï¼š
```bash
node scripts/test-user-management.js
```

### æ‰‹åŠ¨æµ‹è¯•è¦ç‚¹
1. **é¡µé¢è®¿é—®**: ç¡®è®¤ç®¡ç†å‘˜å¯æ­£å¸¸è®¿é—® `/admin/users`
2. **æ•°æ®å±•ç¤º**: éªŒè¯ç”¨æˆ·åˆ—è¡¨æ­£ç¡®æ˜¾ç¤º
3. **æœç´¢ç­›é€‰**: æµ‹è¯•å„ç§æœç´¢å’Œç­›é€‰æ¡ä»¶
4. **ç¼–è¾‘åŠŸèƒ½**: ä¿®æ”¹ç”¨æˆ·è§’è‰²å’ŒçŠ¶æ€
5. **å°ç¦æ“ä½œ**: æ‰§è¡Œå•ä¸ªå’Œæ‰¹é‡å°ç¦
6. **æƒé™æ§åˆ¶**: éªŒè¯éç®¡ç†å‘˜æ— æ³•è®¿é—®

## ğŸš€ éƒ¨ç½²è¯´æ˜

### æ•°æ®åº“è¿ç§»
```bash
-- åº”ç”¨æœ€æ–°çš„æ•°æ®åº“è¿ç§»
supabase migration up
```

### ç¯å¢ƒé…ç½®
ç¡®ä¿ä»¥ä¸‹ç¯å¢ƒå˜é‡å·²è®¾ç½®ï¼š
- `NEXT_PUBLIC_SUPABASE_URL`
- `SUPABASE_SERVICE_ROLE_KEY`

### ç”Ÿäº§éƒ¨ç½²æ£€æŸ¥æ¸…å•
- [ ] æ•°æ®åº“è¿ç§»å·²åº”ç”¨
- [ ] APIè·¯ç”±æ­£å¸¸å·¥ä½œ
- [ ] å‰ç«¯é¡µé¢å¯è®¿é—®
- [ ] æƒé™æ§åˆ¶ç”Ÿæ•ˆ
- [ ] æ—¥å¿—è®°å½•æ­£å¸¸

## ğŸ“ˆ åç»­ä¼˜åŒ–å»ºè®®

### åŠŸèƒ½æ‰©å±•
1. **ç”¨æˆ·è¯¦æƒ…é¡µ**: å±•ç¤ºæ›´è¯¦ç»†çš„ç”¨æˆ·ä¿¡æ¯å’Œæ“ä½œå†å²
2. **æ“ä½œæ—¥å¿—**: å®Œæ•´çš„ç”¨æˆ·æ“ä½œå®¡è®¡è¿½è¸ª
3. **æƒé™ç»§æ‰¿**: æ”¯æŒè§’è‰²æƒé™çš„ç»§æ‰¿å’Œè¦†ç›–
4. **é€šçŸ¥ç³»ç»Ÿ**: ç”¨æˆ·çŠ¶æ€å˜æ›´æ—¶å‘é€é€šçŸ¥

### æ€§èƒ½ä¼˜åŒ–
1. **ç¼“å­˜ç­–ç•¥**: å¯¹é¢‘ç¹æŸ¥è¯¢çš„æ•°æ®æ·»åŠ ç¼“å­˜
2. **åˆ†é¡µä¼˜åŒ–**: å¤§é‡æ•°æ®æ—¶çš„åˆ†é¡µåŠ è½½ä¼˜åŒ–
3. **æœç´¢ä¼˜åŒ–**: æ”¯æŒå…¨æ–‡æœç´¢å’Œæ¨¡ç³ŠåŒ¹é…

### ç”¨æˆ·ä½“éªŒ
1. **æ“ä½œåé¦ˆ**: æ›´ç›´è§‚çš„æ“ä½œæˆåŠŸ/å¤±è´¥æç¤º
2. **æ‰¹é‡å¯¼å…¥**: æ”¯æŒExcelæ‰¹é‡å¯¼å…¥ç”¨æˆ·
3. **å¯¼å‡ºåŠŸèƒ½**: ç”¨æˆ·æ•°æ®å¯¼å‡ºä¸ºCSV/Excelæ ¼å¼

---

**å®ŒæˆçŠ¶æ€**: âœ… å·²å®Œæˆ  
**æœ€åæ›´æ–°**: 2026å¹´2æœˆ14æ—¥  
**è´Ÿè´£äºº**: AIåŠ©æ‰‹